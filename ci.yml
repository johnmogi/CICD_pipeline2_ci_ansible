steps:
  - script: |
      echo '''
        PORT: $(PORT)
        HOST: $(HOST)
        HOST_URL: $(HOST_URL)
        COOKIE_ENCRYPT_PWD: $(COOKIE_ENCRYPT_PWD)
        NODE_ENV: $(NODE_ENV)
        OKTA_ORG_URL: $(OKTA_ORG_URL)
        OKTA_CLIENT_ID: $(OKTA_CLIENT_ID)
        OKTA_CLIENT_SECRET: $(OKTA_CLIENT_SECRET)
        PGHOST: $(PGHOST)
        PGUSERNAME: $(PGUSERNAME)
        PGDATABASE: $(PGDATABASE)
        PGPASSWORD: $(PGPASSWORD)
        PGPORT: $(PGPORT)
        ''' > psecret.yml

  - task: CopyFiles@2
    inputs:
      SourceFolder: "$(Build.SourcesDirectory)"
      Contents: "**/**"
      TargetFolder: "$(build.artifactstagingdirectory)"
    displayName: "prepare artifacts"

  - task: DownloadPackage@1
  inputs:
    packageType: 'upack'
      feed: '/f3be00d4-d77a-40e2-a0a4-997840fa8608'
      view: 'b0454d3a-695d-440f-bb04-f7972c8072df'
      definition: 'f4258cb0-bdb0-4e4a-8887-5706ee4e4575'
  downloadPath: '$(System.ArtifactsDirectory)'

  - task: UniversalPackages@0
    inputs:
      command: "publish"
      publishDirectory: "$(Build.ArtifactStagingDirectory)"
      feedsToUsePublish: "internal"
      vstsFeedPublish: "f3be00d4-d77a-40e2-a0a4-997840fa8608"
      vstsFeedPackagePublish: "arti"
      versionOption: "patch"
